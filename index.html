<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Arrow Tune Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!--
  Arrow Tune Calculator v1.0.10
  - Adds Add'l String Weight to bow setup and folds it into FPS estimate
  - Actual FPS now auto-estimates from IBO/ATA + draw length/weight + total arrow + string weight, but remains chrono-overridable
  - "Furthest shot" (was Arc Range) moved next to Actual FPS and used for trajectory/velocity visuals
-->
  <style>
    :root {
      --bg: #020617;
      --bg-card: #030712;
      --bg-soft: #0b1220;
      --border: #1f2937;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.12);
      --accent-strong: #16a34a;
      --accent-warn: #f97316;
      --accent-bad: #ef4444;
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --shadow-soft: 0 12px 30px rgba(15, 23, 42, 0.8);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --focus-ring: 0 0 0 1px #22c55e, 0 0 0 4px rgba(34, 197, 94, 0.3);
      --info: #38bdf8;
    }

    [data-theme="light"] {
      --bg: #f5f3e8;
      --bg-card: #ffffff;
      --bg-soft: #f2eee2;
      --border: #d4d4d4;
      --accent: #15803d;
      --accent-soft: rgba(21, 128, 61, 0.08);
      --accent-strong: #16a34a;
      --accent-warn: #ea580c;
      --accent-bad: #b91c1c;
      --text: #111827;
      --text-muted: #4b5563;
      --text-soft: #6b7280;
      --shadow-soft: 0 10px 24px rgba(15, 23, 42, 0.2);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0b1120, var(--bg));
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
      transition: background 0.3s ease, color 0.3s ease;
    }

    .app-shell {
      max-width: 1200px;
      margin: 0 auto;
      background:
        radial-gradient(circle at top left, rgba(34,197,94,0.03), transparent),
        radial-gradient(circle at bottom right, rgba(59,130,246,0.03), transparent),
        var(--bg-card);
      border-radius: 24px;
      box-shadow: var(--shadow-soft);
      padding: 20px 18px 24px;
      border: 1px solid rgba(148,163,184,0.5);
    }

    @media (min-width: 960px) {
      .app-shell { padding: 24px 28px 30px; }
    }

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .title-block { display: flex; flex-direction: column; gap: 4px; }

    h1 {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, #22c55e, #a3e635);
      box-shadow: 0 0 12px rgba(34,197,94,0.8);
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 2px;
    }

    .chip {
      border-radius: 999px;
      padding: 2px 10px;
      border: 1px solid rgba(148,163,184,0.6);
      font-size: 0.75rem;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, rgba(15,23,42,0.9), rgba(30,64,175,0.5));
    }

    [data-theme="light"] .chip {
      background: linear-gradient(135deg, #fefce8, #ffffff);
    }

    .version-pill {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-muted);
      white-space: nowrap;
    }

    .toolbar { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }

    .theme-toggle,
    .btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      padding: 4px 10px;
      font-size: 0.8rem;
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(30,64,175,0.5));
      color: var(--text);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
    }

    [data-theme="light"] .theme-toggle,
    [data-theme="light"] .btn {
      background: linear-gradient(135deg, #fefce8, #ffffff);
    }

    .theme-toggle:hover,
    .btn:hover {
      transform: translateY(-0.5px);
      box-shadow: 0 0 0 1px rgba(148,163,184,0.7);
    }

    .btn-primary {
      border-color: var(--accent-strong);
      background: linear-gradient(135deg, var(--accent-strong), #22c55e);
      color: #022c22;
      font-weight: 600;
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.5fr);
      gap: 16px;
      margin-top: 10px;
    }

    @media (max-width: 960px) {
      main { grid-template-columns: minmax(0, 1fr); }
    }

    .col { display: flex; flex-direction: column; gap: 12px; }

    .panel {
      border-radius: var(--radius-lg);
      background: radial-gradient(circle at top, rgba(15,23,42,0.96), var(--bg-card));
      border: 1px solid rgba(148,163,184,0.55);
      padding: 12px 12px 14px;
      box-shadow: 0 8px 18px rgba(15,23,42,0.7);
    }

    [data-theme="light"] .panel {
      background: radial-gradient(circle at top, #fefce8, #ffffff);
      border-color: rgba(148,163,184,0.8);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 8px;
    }

    .panel-title {
      font-size: 1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .panel-subtitle {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .field-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px 10px;
    }

    @media (max-width: 720px) {
      .field-grid { grid-template-columns: minmax(0,1fr); }
    }

    .field { display: flex; flex-direction: column; gap: 2px; }

    .field-label {
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--text-muted);
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .field-label .aux {
      font-weight: 400;
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .field input,
    .field textarea,
    .field select {
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.8);
      background: rgba(15,23,42,0.85);
      color: var(--text);
      font-size: 0.84rem;
      padding: 6px 8px;
      outline: none;
      width: 100%;
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s, transform 0.08s;
    }

    [data-theme="light"] .field input,
    [data-theme="light"] .field textarea,
    [data-theme="light"] .field select {
      background: #ffffff;
    }

    .field input:focus,
    .field textarea:focus,
    .field select:focus {
      border-color: var(--accent);
      box-shadow: var(--focus-ring);
      transform: translateY(-0.5px);
    }

    .field input[readonly] {
      background: rgba(15,23,42,0.6);
      color: var(--text-soft);
    }

    [data-theme="light"] .field input[readonly] {
      background: #f9fafb;
    }

    .field textarea { min-height: 70px; resize: vertical; }

    .toggle-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 4px 0;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .toggle-row input[type=checkbox] {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    .info-icon {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.9);
      color: var(--info);
      width: 18px;
      height: 18px;
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
    }

    [data-theme="light"] .info-icon { background: #ffffff; }

    .info-text {
      font-size: 0.76rem;
      color: var(--text-soft);
      margin-top: 4px;
      padding: 4px 6px;
      border-left: 2px solid rgba(148,163,184,0.7);
      background: radial-gradient(circle at left, rgba(15,23,42,0.7), transparent);
      border-radius: 0 10px 10px 0;
    }

    [data-theme="light"] .info-text {
      background: radial-gradient(circle at left, #fefce8, transparent);
    }

    .info-text[hidden] { display: none; }

    .chip-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.76rem;
      border: 1px solid rgba(148,163,184,0.9);
      background: radial-gradient(circle at top, rgba(15,23,42,0.95), rgba(15,23,42,0.8));
      color: var(--text-soft);
      margin-top: 4px;
    }

    [data-theme="light"] .chip-tag {
      background: radial-gradient(circle at top, #fefce8, #ffffff);
    }

    .chip-tag.good {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent-strong);
    }

    .chip-tag.warn {
      border-color: var(--accent-warn);
      background: rgba(249,115,22,0.12);
      color: var(--accent-warn);
    }

    .chip-tag.bad {
      border-color: var(--accent-bad);
      background: rgba(239,68,68,0.12);
      color: var(--accent-bad);
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
    }

    @media (max-width: 720px) {
      .results-grid { grid-template-columns: minmax(0,1fr); }
    }

    .result-pill {
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.8);
      padding: 6px 8px;
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(15,23,42,0.7));
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.8rem;
    }

    [data-theme="light"] .result-pill {
      background: radial-gradient(circle at top, #fefce8, #ffffff);
    }

    .result-label { font-size: 0.75rem; color: var(--text-soft); }
    .result-value { font-size: 0.9rem; font-weight: 600; }

    .visual-section {
      margin-top: 8px;
      border-radius: var(--radius-md);
      padding: 8px 10px;
      border: 1px solid rgba(148,163,184,0.7);
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(15,23,42,0.7));
    }

    [data-theme="light"] .visual-section {
      background: radial-gradient(circle at top, #fefce8, #ffffff);
    }

    .visual-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .visual-title { font-size: 0.86rem; font-weight: 700; }

    .balance-bar {
      position: relative;
      height: 10px;
      margin: 6px 0 3px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(37,99,235,0.3), rgba(22,163,74,0.3));
      overflow: hidden;
    }

    .balance-mid {
      position: absolute;
      left: 50%;
      top: -3px;
      bottom: -3px;
      width: 2px;
      background: rgba(248,250,252,0.9);
      opacity: 0.8;
    }

    .balance-marker {
      position: absolute;
      width: 4px;
      top: -3px;
      bottom: -3px;
      background: #f97316;
      border-radius: 999px;
      box-shadow: 0 0 6px rgba(249,115,22,0.9);
    }

    .balance-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .gauge-bar {
      position: relative;
      margin: 6px 0 2px;
      height: 14px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(148,163,184,0.3), rgba(148,163,184,0.6));
      overflow: hidden;
    }

    .gauge-range {
      position: absolute;
      left: 45%;
      width: 25%;
      top: 0;
      bottom: 0;
      background: linear-gradient(90deg, rgba(34,197,94,0.3), rgba(22,163,74,0.7));
    }

    .gauge-marker {
      position: absolute;
      top: -3px;
      bottom: -3px;
      width: 2px;
      background: #22c55e;
      box-shadow: 0 0 6px rgba(34,197,94,0.9);
    }

    .gauge-axis-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .weight-bar {
      position: relative;
      height: 16px;
      max-width: 360px;
      width: 100%;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 6px;
      display: flex;
    }

    .weight-segment { height: 100%; }

    .weight-segment.shaft {
      background: linear-gradient(90deg, rgba(59,130,246,0.9), rgba(37,99,235,0.95));
    }

    .weight-segment.point {
      background: linear-gradient(90deg, rgba(220,38,38,0.9), rgba(248,113,113,0.95));
    }

    .weight-segment.tail {
      background: linear-gradient(90deg, rgba(16,185,129,0.9), rgba(52,211,153,0.95));
    }

    .weight-midline {
      position: absolute;
      left: 50%;
      top: -3px;
      bottom: -3px;
      width: 2px;
      background: rgba(248,250,252,0.9);
      opacity: 0.8;
    }

    .weight-legend {
      font-size: 0.75rem;
      color: var(--text-soft);
      text-align: center;
      margin-top: 4px;
      white-space: pre-line;
    }

    .trajectory-svg {
      width: 100%;
      max-width: 380px;
      height: auto;
      max-height: 260px;
      display: block;
      margin: 0 auto;
      border-radius: 12px;
      background: radial-gradient(circle at top, #0b1120, #020617);
      border: 1px solid rgba(148,163,184,0.8);
    }

    [data-theme="light"] .trajectory-svg {
      background: radial-gradient(circle at top, #eef2ff, #ffffff);
    }

    .velocity-svg {
      width: 100%;
      max-width: 380px;
      height: auto;
      max-height: 180px;
      display: block;
      margin: 0 auto;
      border-radius: 12px;
      background: radial-gradient(circle at top, #020617, #020617);
      border: 1px solid rgba(148,163,184,0.8);
    }

    [data-theme="light"] .velocity-svg {
      background: radial-gradient(circle at top, #eef2ff, #ffffff);
    }

    .data-table-wrap {
      margin-top: 8px;
      max-height: 260px;
      overflow: auto;
      border-radius: var(--radius-md);
      border: 1px solid rgba(148,163,184,0.7);
      background: radial-gradient(circle at top, rgba(15,23,42,0.98), rgba(15,23,42,0.9));
    }

    [data-theme="light"] .data-table-wrap {
      background: radial-gradient(circle at top, #fefce8, #ffffff);
    }

    table { width: 100%; border-collapse: collapse; font-size: 0.78rem; }

    thead {
      position: sticky;
      top: 0;
      background: rgba(15,23,42,0.95);
      z-index: 1;
    }

    [data-theme="light"] thead { background: #fef3c7; }

    th, td {
      padding: 4px 6px;
      border-bottom: 1px solid rgba(148,163,184,0.5);
      text-align: left;
      white-space: nowrap;
    }

    tbody tr:nth-child(odd) { background: rgba(15,23,42,0.7); }
    tbody tr:nth-child(even){ background: rgba(15,23,42,0.85); }

    [data-theme="light"] tbody tr:nth-child(odd) { background: rgba(254,249,195,0.5); }
    [data-theme="light"] tbody tr:nth-child(even){ background: #ffffff; }

    .type-badge {
      display: inline-block;
      padding: 1px 5px;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-soft);
    }

    .type-badge.input {
      border-color: rgba(59,130,246,0.9);
      color: #60a5fa;
    }

    .type-badge.calc {
      border-color: var(--accent-strong);
      color: var(--accent-strong);
    }

    .small { font-size: 0.72rem; }
  </style>
</head>
<body data-theme="dark">
  <div class="app-shell">
    <header class="header-row">
      <div class="title-block">
        <h1><span class="logo-dot"></span>Arrow Tune Calculator</h1>
        <div class="subtitle">Visual, data-rich arrow tuning for bowhunters &amp; target archers.</div>
        <div class="chip-row">
          <div class="chip">Live FOC, GPP, GPI, momentum &amp; KE</div>
          <div class="chip">üèπ Works offline in your browser</div>
          <span class="version-pill">v1.0.10 ¬∑ 2025-12-03</span>
        </div>
      </div>
      <div class="toolbar">
        <button id="themeToggle" type="button" class="theme-toggle">üåó Theme</button>
        <button id="saveBuildBtn" type="button" class="btn btn-primary">üíæ Save build</button>
        <button id="downloadInputsCsvBtn" type="button" class="btn">‚¨áÔ∏è Inputs-only CSV</button>
        <a
          href="https://patreon.com/ArrowTuneCalculator"
          target="_blank"
          rel="noopener noreferrer"
          class="btn"
          style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;"
          title="Help fund new features like AI suggestions, gear presets, and mobile enhancements."
        >
          ‚ù§Ô∏è Support on Patreon
        </a>
      </div>
    </header>

    <main>
      <!-- LEFT COLUMN -->
      <section class="col">

        <!-- Saved builds -->
        <article class="panel">
          <div class="panel-header">
            <div>
              <div class="panel-title">
                Saved builds
                <button type="button" class="info-icon" data-info-target="saved-builds-info">i</button>
              </div>
              <div class="panel-subtitle">
                Name, save, reload, and move builds via CSV. Stored only in this browser.
              </div>
              <div id="saved-builds-info" class="info-text" hidden>
                Saved builds are stored in your browser using localStorage. Use the CSV export/import
                if you want to move setups between browsers or devices.
              </div>
            </div>
          </div>

          <div class="field-grid">
            <div class="field">
              <label class="field-label" for="savedBuildName">
                Saved build name
                <span class="aux">(auto-suggested)</span>
              </label>
              <input id="savedBuildName" type="text" placeholder="2025-11 Hoyt RX-9 Easton 5.0 500 gr 70 lb draw">
            </div>
            <div class="field">
              <label class="field-label">&nbsp;</label>
              <button id="refreshNameBtn" type="button" class="btn" style="width:100%;">üîÅ Suggest name</button>
            </div>
          </div>

          <div style="display:flex;flex-wrap:wrap;gap:6px;align-items:center;margin-top:8px;" class="small">
            <span>Saved builds:</span>
            <select id="savedBuildsSelect" style="max-width:260px;">
              <option value="">(none yet)</option>
            </select>
            <button id="loadBuildBtn" type="button" class="btn">üìÇ Load selected</button>
          </div>

          <div style="display:flex;flex-wrap:wrap;gap:6px;align-items:center;margin-top:8px;" class="small">
            <span>Upload inputs CSV:</span>
            <input id="csvUpload" type="file" accept=".csv" style="max-width:230px;">
            <span>(uses first data row exported from this tool)</span>
          </div>
        </article>

        <!-- Bow -->
        <article class="panel">
          <div class="panel-header">
            <div>
              <div class="panel-title">
                Bow
                <button type="button" class="info-icon" data-info-target="bow-info">i</button>
              </div>
              <div id="bow-info" class="info-text" hidden>
                Basic bow setup so we can relate arrow weight to draw weight and estimate speed, KE, and efficiency.
              </div>
            </div>
          </div>
          <div class="field-grid">
            <div class="field">
              <label class="field-label" for="bowModel">Bow model &amp; year
                <span class="aux">(e.g. 2025 Hoyt RX-9)</span>
              </label>
              <input id="bowModel" type="text" placeholder="2025 Hoyt RX-9">
            </div>
            <div class="field">
              <label class="field-label" for="shooterName">Shooter name
                <span class="aux">(optional)</span>
              </label>
              <input id="shooterName" type="text" placeholder="Shooter">
            </div>
            <div class="field">
              <label class="field-label" for="drawWeight">Draw weight (lb)
                <span class="aux">Rule: ~15‚Äì20 fps per 10 lb change</span>
              </label>
              <input id="drawWeight" type="number" min="10" max="100" step="0.5" value="70">
            </div>
            <div class="field">
              <label class="field-label" for="drawLength">Draw length (in)
                <span class="aux">Rule: ~10 fps per inch change</span>
              </label>
              <input id="drawLength" type="number" min="20" max="34" step="0.25" value="28">
            </div>
            <div class="field">
              <label class="field-label" for="letOffPct">Let-off (%)</label>
              <input id="letOffPct" type="number" min="0" max="100" step="1" placeholder="80">
            </div>
            <div class="field">
              <label class="field-label" for="iboRating">
                IBO/ATA Rating (FPS)
                <span class="aux">(manufacturer spec or chrono)</span>
              </label>
              <input id="iboRating" type="number" min="200" max="380" step="1" placeholder="e.g. 335">
            </div>
            <div class="field">
              <label class="field-label" for="stringWeightExtra">
                Add'l string weight (gr)
                <span class="aux">(peep, D-loop, silencers, etc.)</span>
              </label>
              <input id="stringWeightExtra" type="number" min="0" max="200" step="0.5" value="0">
            </div>
          </div>
        </article>

        <!-- Arrow info -->
        <article class="panel">
          <div class="panel-header">
            <div>
              <div class="panel-title">
                Arrow info
                <button type="button" class="info-icon" data-info-target="arrow-info">i</button>
              </div>
              <div id="arrow-info" class="info-text" hidden>
                High-level labels so you can compare different arrow builds. Useful when saving multiple arrows or shooters.
              </div>
            </div>
          </div>
          <div class="field-grid">
            <div class="field">
              <label class="field-label" for="arrowName">Arrow name
                <span class="aux">(e.g. Easton 5.0 250 spine match grade)</span>
              </label>
              <input id="arrowName" type="text" placeholder="Easton 5.0 250 spine match grade">
            </div>
            <div class="field">
              <label class="field-label" for="arrowSpine">Arrow spine
                <span class="aux">(e.g. 250, 300, 350)</span>
              </label>
              <input id="arrowSpine" type="number" min="150" max="800" step="10" placeholder="300">
            </div>
            <div class="field">
              <label class="field-label" for="straightness">Straightness
                <span class="aux">(e.g. ¬±0.001&quot;)</span>
              </label>
              <input id="straightness" type="text" placeholder="¬±0.001&quot;">
            </div>
          </div>
        </article>

        <!-- Arrow shaft & total weight + components -->
        <article class="panel">
          <div class="panel-header">
            <div>
              <div class="panel-title">
                Arrow shaft &amp; total weight
                <button type="button" class="info-icon" data-info-target="shaft-info">i</button>
              </div>
              <div class="panel-subtitle">
                Arrow length and finished total arrow weight from your scale. Component details are optional.
              </div>
              <div id="shaft-info" class="info-text" hidden>
                Arrow length and the finished total arrow weight from your scale. Most people only need arrow length,
                total arrow weight, and balance point. If you enter a full component breakdown in the advanced section,
                that total will be used instead of this field.
              </div>
            </div>
          </div>
          <div class="field-grid">
            <div class="field">
              <label class="field-label" for="arrowLength">Arrow length (in)
                <span class="aux">nock throat to end of shaft (excluding point)</span>
              </label>
              <input id="arrowLength" type="number" min="20" max="36" step="0.25" value="28.25">
            </div>
            <div class="field">
              <label class="field-label" for="totalArrowWeight">Total arrow weight (gr)
                <span class="aux">finished arrow on scale; rule: +5 gr ‚âà ‚àí1‚Äì1.5 fps</span>
              </label>
              <input id="totalArrowWeight" type="number" min="200" max="900" step="0.1" value="500">
            </div>
            <div class="field">
              <label class="field-label" for="balancePoint">Balance point (in from nock)
                <span class="aux">(measure to balance point)</span>
              </label>
              <input id="balancePoint" type="number" min="10" max="36" step="0.01" value="18.5">
            </div>
          </div>

          <div class="toggle-row">
            <input id="showComponents" type="checkbox">
            <label for="showComponents">Show advanced component breakdown</label>
          </div>

          <div id="componentsSection" class="panel" style="margin-top:6px; padding:8px 10px; display:none;">
            <div class="panel-header" style="margin-bottom:4px;">
              <div>
                <div class="panel-title" style="font-size:0.9rem;">
                  Components (Advanced)
                  <button type="button" class="info-icon" data-info-target="components-info">i</button>
                </div>
                <div class="panel-subtitle">
                  Detailed component weights are only needed if you track each part with a small scale.
                </div>
                <div id="components-info" class="info-text" hidden>
                  Detailed component weights, including bare shaft, are only needed if you track each part with a small scale.
                  If you complete all the main component fields (bare shaft, nock, vanes, insert, point), the calculator will
                  use their sum as the total arrow weight. Otherwise, it will use the total arrow weight field above.
                </div>
              </div>
            </div>
            <div class="field-grid">
              <div class="field">
                <label class="field-label" for="bareShaftWeight">Bare shaft weight (gr)</label>
                <input id="bareShaftWeight" type="number" min="100" max="600" step="0.1">
              </div>
              <div class="field">
                <label class="field-label" for="nockWeight">Nock weight (gr)</label>
                <input id="nockWeight" type="number" min="3" max="30" step="0.1">
              </div>
              <div class="field">
                <label class="field-label" for="wrapWeight">Wrap weight (gr)
                  <span class="aux">(optional)</span>
                </label>
                <input id="wrapWeight" type="number" min="0" max="40" step="0.1">
              </div>
              <div class="field">
                <label class="field-label" for="vaneCount">Vane count</label>
                <input id="vaneCount" type="number" min="0" max="6" step="1" value="3">
              </div>
              <div class="field">
                <label class="field-label" for="vaneWeight">Vane weight (each, gr)</label>
                <input id="vaneWeight" type="number" min="1" max="25" step="0.1">
              </div>
              <div class="field">
                <label class="field-label" for="insertWeight">Insert / outsert / half-out (gr)</label>
                <input id="insertWeight" type="number" min="0" max="120" step="0.1">
              </div>
              <div class="field">
                <label class="field-label" for="pointWeight">Point weight (gr)</label>
                <input id="pointWeight" type="number" min="50" max="300" step="0.1">
              </div>
              <div class="field">
                <label class="field-label" for="glueWeight">Glue weight estimate (gr)
                  <span class="aux">(5‚Äì10 gr typical)</span>
                </label>
                <input id="glueWeight" type="number" min="0" max="30" step="0.1">
              </div>
            </div>
          </div>
        </article>
      </section>
            <!-- RIGHT COLUMN -->
      <section class="col">

        <!-- FOC, weight distribution & bow/arrow efficiency -->
        <article class="panel">
          <div class="panel-header">
            <div>
              <div class="panel-title">FOC, Weight Distribution &amp; Bow/Arrow Efficiency</div>
              <div class="panel-subtitle">
                Visualize balance point, FOC, weight split, and how well your arrow matches your bow‚Äôs stored energy.
              </div>
            </div>
          </div>

          <!-- Arrow balance -->
          <div class="visual-section">
            <div class="visual-header">
              <div class="visual-title">
                Arrow Balance (Nock ‚Üí Point)
                <button type="button" class="info-icon" data-info-target="balance-info">i</button>
              </div>
            </div>
            <div id="balance-info" class="info-text" hidden>
              Center line = geometric center. Orange marker = your measured balance point (driven by FOC).
            </div>

            <div class="balance-bar">
              <div class="balance-mid"></div>
              <div id="balanceMarker" class="balance-marker"></div>
            </div>
            <div class="balance-labels">
              <span>Nock end</span>
              <span>Point end</span>
            </div>
            <div class="chip-tag" id="balanceSummaryTag">
              Balance point: <strong><span id="balancePointOut">0.0</span>"</strong>
            </div>
          </div>

          <!-- FOC gauge -->
          <div class="visual-section" style="margin-top:8px;">
            <div class="visual-header">
              <div class="visual-title">
                FOC Shift Gauge
                <button type="button" class="info-icon" data-info-target="foc-gauge-info">i</button>
              </div>
            </div>

            <div id="foc-gauge-info" class="info-text" hidden>
              Green zone ‚âà typical hunting FOC. Extreme values may affect flight stability.
            </div>

            <div class="gauge-bar">
              <div class="gauge-range"></div>
              <div id="focMarker" class="gauge-marker"></div>
            </div>
            <div class="gauge-axis-labels">
              <span>-10%</span><span>+30%</span>
            </div>

            <div id="focTag" class="chip-tag">
              FOC: <strong><span id="focValue">0.0</span>%</strong>
              <span id="focBandLabel">(no data)</span>
            </div>
          </div>

          <!-- Weight composition -->
          <div class="visual-section" style="margin-top:8px;">
            <div class="visual-header">
              <div class="visual-title">
                Weight Composition
                <button type="button" class="info-icon" data-info-target="weight-comp-info">i</button>
              </div>
            </div>

            <div id="weight-comp-info" class="info-text" hidden>
              Shows where your arrow mass sits: shaft, point system, and tail components.
            </div>

            <div style="display:flex;flex-direction:column;align-items:center;">
              <div class="weight-bar">
                <div id="shaftSegment" class="weight-segment shaft"></div>
                <div id="pointSegment" class="weight-segment point"></div>
                <div id="tailSegment" class="weight-segment tail"></div>
                <div class="weight-midline"></div>
              </div>
              <div id="weightLegend" class="weight-legend">
                Shaft: 0.0 gr (0%)  
                Point system: 0.0 gr (0%)  
                Nock/wrap/vanes/glue: 0.0 gr (0%)
              </div>
            </div>
          </div>

          <!-- Bow/Arrow Efficiency -->
          <div class="visual-section" style="margin-top:8px;">
            <div class="visual-header">
              <div class="visual-title">
                Bow/Arrow Efficiency Match
                <button type="button" class="info-icon" data-info-target="efficiency-info">i</button>
              </div>
            </div>

            <div id="efficiency-info" class="info-text" hidden>
              Compares arrow kinetic energy vs bow stored energy. Useful for matching arrow weight to bow.
            </div>

            <div class="gauge-bar">
              <div class="gauge-range"></div>
              <div id="efficiencyMarker" class="gauge-marker"></div>
            </div>
            <div class="gauge-axis-labels">
              <span>50%</span><span>90%+</span>
            </div>

            <div id="efficiencyTag" class="chip-tag">
              Efficiency: <strong><span id="efficiencyValue">0</span>%</strong>
              <span id="efficiencyBandLabel">(no data)</span>
            </div>
          </div>
        </article>


        <!-- Velocity Drop-Off & Time-of-Flight -->
        <article class="panel">
          <div class="panel-header">
            <div>
              <div class="panel-title">
                Velocity Drop-Off &amp; Time-of-Flight
                <button type="button" class="info-icon" data-info-target="velocity-info">i</button>
              </div>
              <div class="panel-subtitle">
                Uses dynamic (IBO-adjusted) Actual FPS + arrow weight. Distance focus below drives both charts.
              </div>
            </div>
          </div>

          <!-- Distance focus slider -->
          <div class="visual-section">
            <div class="visual-header">
              <div class="visual-title">Distance Focus</div>
            </div>

            <div class="field-grid">
              <div class="field">
                <label class="field-label">Distance (yd)</label>
                <input id="velDistance" type="range" min="0" max="100" value="40">
              </div>

              <div class="field">
                <label class="field-label">&nbsp;</label>
                <input id="velDistanceValue" type="text" value="40 yd" readonly>
              </div>
            </div>
          </div>

          <!-- Actual FPS (live auto-updating) + Furthest Shot field -->
          <div class="visual-section" style="margin-top:8px;">
            <div class="visual-header">
              <div class="visual-title">Actual FPS &amp; Max Range</div>
            </div>

            <div class="field-grid">

              <div class="field">
                <label class="field-label" for="actualFps">
                  Actual FPS
                  <span class="aux">Auto-calculated from bow specs (editable)</span>
                </label>
                <input
                  id="actualFps"
                  type="number"
                  min="140"
                  max="380"
                  step="1"
                  placeholder="Calculated"
                >
              </div>

              <div class="field">
                <label class="field-label" for="arcRange">
                  Furthest Shot (yd)
                  <span class="aux">(sets trajectory max distance)</span>
                </label>
                <input id="arcRange" type="number" min="10" max="150" value="60">
              </div>

            </div>
          </div>

          <!-- Velocity Chart -->
          <div class="visual-section" style="margin-top:8px;">
            <div class="visual-header">
              <div class="visual-title">Velocity Curve &amp; Time-of-Flight</div>
            </div>

            <svg id="velocitySvg" class="velocity-svg" viewBox="0 0 320 180"></svg>
            <div class="small" id="velocitySummary">
              No data yet ‚Äî enter bow &amp; arrow details.
            </div>
          </div>
        </article>
        <script>
/* ============================================================
   Arrow Tune Calculator v1.0.10
   - Added Add'l String Weight to Bow panel
   - Actual FPS auto-calculated (Ashby + industry rules)
   - Furthest Shot moved next to Actual FPS
   - Total arrow + string weight drives FPS, KE, momentum
   ============================================================ */

const state = { inputs: {}, computed: {}, savedBuilds: [] };
let manualActualFps = false;
let speedLossManual = false;

function $(id) { return document.getElementById(id); }

/* ---------- Utility Helpers ---------- */
function getNum(id) {
  const el = $(id);
  if (!el) return 0;
  const v = parseFloat(el.value);
  return isNaN(v) ? 0 : v;
}

function getStr(id) {
  const el = $(id);
  return el ? (el.value || '').trim() : '';
}

function setValue(id, val) {
  const el = $(id);
  if (el) el.value = val;
}

function setText(id, val) {
  const el = $(id);
  if (el) el.textContent = val;
}

/* ---------- Read Inputs ---------- */
function readInputs() {
  state.inputs = {
    // Bow
    bowModel: getStr("bowModel"),
    shooterName: getStr("shooterName"),
    drawWeight: getNum("drawWeight"),
    drawLength: getNum("drawLength"),
    letOffPct: getNum("letOffPct"),
    iboRating: getNum("iboRating"),
    stringWeight: getNum("stringWeight"),

    // Arrow
    arrowName: getStr("arrowName"),
    arrowSpine: getNum("arrowSpine"),
    straightness: getStr("straightness"),

    arrowLength: getNum("arrowLength"),
    totalArrowWeight: getNum("totalArrowWeight"),
    balancePoint: getNum("balancePoint"),

    // Advanced components
    showComponents: $("showComponents")?.checked || false,
    bareShaftWeight: getNum("bareShaftWeight"),
    nockWeight: getNum("nockWeight"),
    wrapWeight: getNum("wrapWeight"),
    vaneCount: getNum("vaneCount"),
    vaneWeight: getNum("vaneWeight"),
    insertWeight: getNum("insertWeight"),
    pointWeight: getNum("pointWeight"),
    glueWeight: getNum("glueWeight"),

    // Velocity & trajectory
    velDistance: getNum("velDistance"),
    arcRange: getNum("arcRange"),

    // FPS / overrides
    actualFps: getNum("actualFps"),

    notes: getStr("notes")
  };
}

/* ---------- Total Arrow System Weight ---------- */
function calcTotalSystemWeight() {
  const i = state.inputs;

  // Base finished arrow
  let arrow = i.totalArrowWeight;

  // Components override finished weight when complete
  if (i.showComponents) {
    const required =
      i.bareShaftWeight > 0 &&
      i.nockWeight >= 0 &&
      i.vaneCount >= 0 &&
      i.vaneWeight >= 0 &&
      i.insertWeight >= 0 &&
      i.pointWeight > 0;

    if (required) {
      arrow =
        i.bareShaftWeight +
        i.nockWeight +
        i.wrapWeight +
        i.vaneCount * i.vaneWeight +
        i.insertWeight +
        i.pointWeight +
        i.glueWeight;
    }
  }

  // Add string accessories: peep, D-loop, silencers, kisser
  const totalSystem = arrow + (i.stringWeight || 0);

  return {
    arrow,
    totalSystem
  };
}

/* ---------- FOC ---------- */
function calcFOC() {
  const i = state.inputs;
  const L = i.arrowLength;
  const bp = i.balancePoint;

  if (L <= 0 || bp <= 0) {
    return { focPct: 0, band: "no data", bandClass: "bad" };
  }

  const center = L / 2;
  const foc = ((bp - center) / L) * 100;

  let band = "no data";
  let cls = "bad";

  if (foc < 8) { band = "Low FOC"; cls = "warn"; }
  else if (foc <= 10) { band = "Borderline hunting FOC"; cls = "good"; }
  else if (foc <= 18) { band = "Typical hunting FOC"; cls = "good"; }
  else if (foc <= 25) { band = "High FOC"; cls = "warn"; }
  else { band = "Extreme FOC"; cls = "warn"; }

  return { focPct: foc, band, bandClass: cls };
}

/* ---------- GPP / GPI ---------- */
function calcGPP(w) {
  const dw = state.inputs.drawWeight;
  if (dw <= 0) return { gpp: 0, band: "no data", cls: "bad" };
  const g = w / dw;

  let b = "no data", c = "bad";
  if (g < 5.3) { b = "Very light"; c = "warn"; }
  else if (g <= 6.3) { b = "Light hunting"; c = "good"; }
  else if (g <= 8.0) { b = "Typical hunting"; c = "good"; }
  else { b = "Heavy hunting"; c = "warn"; }

  return { gpp: g, band: b, cls: c };
}

function calcGPI(w) {
  const L = state.inputs.arrowLength;
  if (L <= 0) return { gpi: 0, band: "no data", cls: "bad" };

  const gpi = w / L;

  let b = "no data", c = "bad";
  if (gpi < 8) { b = "Light"; c = "warn"; }
  else if (gpi <= 10) { b = "Typical hunting"; c = "good"; }
  else { b = "Heavy"; c = "warn"; }

  return { gpi, band: b, cls: c };
}

/* ---------- Actual FPS (Ashby/Industry-Based) ---------- */
function estimateActualFPS(totalSystemWeight) {
  const i = state.inputs;

  let fps = i.iboRating || 280; // fallback baseline

  // +10 fps per inch draw length difference (vs 30")
  fps += (i.drawLength - 30) * 10;

  // +1 fps per pound (vs 70#)
  fps += (i.drawWeight - 70) * 1;

  // Weight penalty: -1 fps per ~5 grains away from 350gr
  fps -= ((totalSystemWeight - 350) / 5);

  // String weight penalty: ~1 fps per 5 grains
  fps -= (i.stringWeight / 5);

  return Math.max(140, Math.min(380, fps));
}

function getEffectiveFPS(totalSystemWeight) {
  const auto = estimateActualFPS(totalSystemWeight);
  const user = state.inputs.actualFps;

  if (!manualActualFps) {
    setValue("actualFps", auto.toFixed(0));
    return auto;
  }

  return user > 0 ? user : auto;
}

/* ---------- Speed Loss ---------- */
function fpsAtDistance(fps, yards, lossPer10 = 5) {
  const segments = yards / 10;
  const lost = lossPer10 * segments;
  return Math.max(0, fps - lost);
}

/* ---------- Momentum / KE ---------- */
function calcMomentum(grains, fps) {
  return (grains * fps) / 225400;
}

function calcKE(grains, fps) {
  return (grains / 450240) * fps * fps;
}

/* ---------- Velocity Curve ---------- */
function drawVelocityCurve(fps0, focusDist) {
  const svg = $("velocitySvg");
  if (!svg) return;

  while (svg.firstChild) svg.removeChild(svg.firstChild);

  if (fps0 <= 0) {
    setText("velocitySummary", "No data ‚Äî enter bow specs.");
    return;
  }

  const lossPer10 = 5;
  const maxDist = Math.max(focusDist, state.inputs.arcRange || 30);

  const w = 320, h = 180;
  const padL = 30, padR = 18, padT = 10, padB = 22;
  const innerW = w - padL - padR;
  const innerH = h - padT - padB;

  function v(d) { return fpsAtDistance(fps0, d, lossPer10); }

  const xs = [], ys = [];
  let vMin = fps0, vMax = 0;

  for (let i = 0; i <= 30; i++) {
    const yd = (maxDist * i) / 30;
    const vf = v(yd);
    vMin = Math.min(vMin, vf);
    vMax = Math.max(vMax, vf);
    xs.push(yd);
    ys.push(vf);
  }

  const ySpan = vMax - vMin || 1;

  function xScale(yd) { return padL + (yd / maxDist) * innerW; }
  function yScale(vv) { return padT + innerH - ((vv - vMin) / ySpan) * innerH; }

  // Axes
  const xAxis = document.createElementNS("http://www.w3.org/2000/svg","line");
  xAxis.setAttribute("x1", padL);
  xAxis.setAttribute("y1", padT + innerH);
  xAxis.setAttribute("x2", padL + innerW);
  xAxis.setAttribute("y2", padT + innerH);
  xAxis.setAttribute("stroke", "#aaa");
  svg.appendChild(xAxis);

  const yAxis = document.createElementNS("http://www.w3.org/2000/svg","line");
  yAxis.setAttribute("x1", padL);
  yAxis.setAttribute("y1", padT);
  yAxis.setAttribute("x2", padL);
  yAxis.setAttribute("y2", padT + innerH);
  yAxis.setAttribute("stroke", "#aaa");
  svg.appendChild(yAxis);

  // Curve line
  let d = "";
  for (let i = 0; i < xs.length; i++) {
    const X = xScale(xs[i]);
    const Y = yScale(ys[i]);
    d += (i === 0 ? "M" : "L") + X + " " + Y + " ";
  }

  const path = document.createElementNS("http://www.w3.org/2000/svg","path");
  path.setAttribute("d", d.trim());
  path.setAttribute("stroke", "#38bdf8");
  path.setAttribute("fill", "none");
  path.setAttribute("stroke-width", "2");
  svg.appendChild(path);

  // Focus marker
  const vf = v(focusDist);
  const fx = xScale(focusDist);
  const fy = yScale(vf);

  const dot = document.createElementNS("http://www.w3.org/2000/svg","circle");
  dot.setAttribute("cx", fx);
  dot.setAttribute("cy", fy);
  dot.setAttribute("r", 3);
  dot.setAttribute("fill", "#22c55e");
  svg.appendChild(dot);

  // TOF label
  const avg = (fps0 + vf) / 2;
  const tof = (focusDist * 3) / avg;

  const label = document.createElementNS("http://www.w3.org/2000/svg","text");
  label.setAttribute("x", fx + 6);
  label.setAttribute("y", fy - 5);
  label.setAttribute("font-size", "10");
  label.setAttribute("fill", "#bef264");
  label.textContent = `${focusDist} yd ‚Ä¢ ~${tof.toFixed(2)} s`;
  svg.appendChild(label);

  setText("velocitySummary", `~${vf.toFixed(0)} fps, ~${tof.toFixed(2)} s @ ${focusDist} yd`);
}

/* ---------- Trajectory Arc ---------- */
function drawTrajectory(fps0, focusDist) {
  const svg = $("trajectorySvg");
  if (!svg) return;

  while (svg.firstChild) svg.removeChild(svg.firstChild);

  const arcRange = Math.max(state.inputs.arcRange || 30, focusDist);
  const peak = Math.min((arcRange / 60) * 4, 12);

  const w = 320, h = 210;
  const padL = 30, padR = 12, padT = 12, padB = 45;
  const innerW = w - padL - padR;
  const innerH = h - padT - padB;

  function xScale(yd) { return padL + (yd / arcRange) * innerW; }
  function yScale(ft) { return padT + innerH - (ft / (peak * 1.4)) * innerH; }

  const mid = arcRange / 2;
  const k = peak / (mid * mid);

  let d = "";
  for (let i = 0; i <= 40; i++) {
    const yd = (arcRange * i) / 40;
    const xd = yd - mid;
    const ht = peak - k * xd * xd;
    const Y = Math.max(0, ht);
    const X = xScale(yd);
    const YY = yScale(Y);
    d += (i === 0 ? "M" : "L") + X + " " + YY + " ";
  }

  const path = document.createElementNS("http://www.w3.org/2000/svg","path");
  path.setAttribute("d", d.trim());
  path.setAttribute("stroke", "#22c55e");
  path.setAttribute("fill", "none");
  path.setAttribute("stroke-width", "2");
  svg.appendChild(path);

  // Focus marker
  const xf = xScale(focusDist);
  const xd = focusDist - mid;
  const yfFt = peak - k * xd * xd;
  const yf = yScale(yfFt);

  const dot = document.createElementNS("http://www.w3.org/2000/svg","circle");
  dot.setAttribute("cx", xf);
  dot.setAttribute("cy", yf);
  dot.setAttribute("r", 3);
  dot.setAttribute("fill", "#38bdf8");
  svg.appendChild(dot);

  setValue("arcMetaInline", `Peak ‚âà ${peak.toFixed(1)} ft`);
  setText("trajectorySummary",
    `Arc ‚âà 0‚Äì${arcRange} yd. Peak ‚âà ${peak.toFixed(1)} ft.`);
}

/* ---------- Recalc & Render ---------- */
function recalcAndRender() {
  const i = state.inputs;
  const weights = calcTotalSystemWeight();
  const arrow = weights.arrow;
  const totalSystem = weights.totalSystem;

  const foc = calcFOC();
  const gpp = calcGPP(arrow);
  const gpi = calcGPI(arrow);

  const fps0 = getEffectiveFPS(totalSystem);

  const focusDist = i.velDistance || i.arcRange || 30;
  const fpsFocus = fpsAtDistance(fps0, focusDist);
  const ke0 = calcKE(arrow, fps0);
  const keF = calcKE(arrow, fpsFocus);
  const mom = calcMomentum(arrow, fpsFocus);

  // Update UI
  setText("momentumValue", mom.toFixed(3));
  setText("keLaunchValueSummary", ke0.toFixed(1));

  drawVelocityCurve(fps0, focusDist);
  drawTrajectory(fps0, focusDist);
}

/* ---------- Input Wiring ---------- */
document.addEventListener("input", e => {
  const id = e.target.id;

  if (id === "actualFps") {
    manualActualFps = true;
  }

  if (id === "velDistance") {
    setValue("velDistanceValue", `${e.target.value} yd`);
  }

  readInputs();
  recalcAndRender();
});

/* ---------- DOM Ready ---------- */
document.addEventListener("DOMContentLoaded", () => {
  readInputs();
  recalcAndRender();
});
</script>