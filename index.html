<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>Arrow Tune Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
            color: #000;
            transition: background 0.3s ease, color 0.3s ease;
        }
        h1 { text-align: center; color: #0066cc; }
        .section { 
            border: 1px solid #ccc; 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 8px; 
            background: #f9f9f9; 
        }
        .input-group { 
            margin: 10px 0; 
            display: flex;
            align-items: center;
        }
        label { 
            display: inline-block; 
            width: 180px; 
            font-weight: bold;
        }
        input, select { 
            width: 120px; 
            padding: 5px; 
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .results { 
            display: grid; 
            gap: 15px; 
        }
        .result-item { 
            padding: 15px; 
            background: #eef; 
            border-radius: 6px; 
            border-left: 4px solid #0066cc;
        }
        .label { 
            font-weight: bold; 
            margin-bottom: 5px; 
            color: #333;
        }
        .value { 
            font-size: 1.5em; 
            font-weight: bold; 
        }
        .interpretation { 
            font-size: 0.9em; 
            color: #555; 
            margin-top: 5px; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 20px 0; 
        }
        th, td { 
            border: 1px solid #999; 
            padding: 8px; 
            text-align: center; 
        }
        th { background: #ddd; }
        button { 
            background: #0066cc; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { background: #0052a3; }
        .toggle-container {
            text-align: center;
            margin: 20px 0;
        }
        #themeToggle {
            background: none;
            border: 2px solid #0066cc;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            transition: border-color 0.3s ease;
        }
        #themeToggle:hover {
            border-color: #0052a3;
        }

        /* Dark mode styles */
        @media (prefers-color-scheme: dark) {
            body {
                background: #121212;
                color: #e0e0e0;
            }
            .section {
                border-color: #444;
                background: #1e1e1e;
            }
            input, select {
                background: #333;
                color: #e0e0e0;
                border-color: #555;
            }
            .result-item {
                background: #2a2a2a;
                border-left-color: #4da6ff;
            }
            .label {
                color: #ccc;
            }
            .interpretation {
                color: #aaa;
            }
            th {
                background: #333;
            }
            th, td {
                border-color: #555;
            }
            button {
                background: #4da6ff;
            }
            button:hover {
                background: #3399ff;
            }
            #themeToggle {
                border-color: #4da6ff;
            }
            #themeToggle:hover {
                border-color: #3399ff;
            }
            h1 {
                color: #4da6ff;
            }
        }
        body.dark {
            background: #121212 !important;
            color: #e0e0e0 !important;
        }
        body.dark .section {
            border-color: #444 !important;
            background: #1e1e1e !important;
        }
        body.dark input, body.dark select {
            background: #333 !important;
            color: #e0e0e0 !important;
            border-color: #555 !important;
        }
        body.dark .result-item {
            background: #2a2a2a !important;
            border-left-color: #4da6ff !important;
        }
        body.dark .label {
            color: #ccc !important;
        }
        body.dark .interpretation {
            color: #aaa !important;
        }
        body.dark th {
            background: #333 !important;
        }
        body.dark th, body.dark td {
            border-color: #555 !important;
        }
        body.dark button {
            background: #4da6ff !important;
        }
        body.dark button:hover {
            background: #3399ff !important;
        }
        body.dark #themeToggle {
            border-color: #4da6ff !important;
        }
        body.dark #themeToggle:hover {
            border-color: #3399ff !important;
        }
        body.dark h1 {
            color: #4da6ff !important;
        }
    </style>
</head>
<body>

    <h1>üèπ Arrow Tune Calculator</h1>

    <!-- Dark/Light Mode Toggle -->
    <div class="toggle-container">
        <button id="themeToggle" aria-label="Toggle dark mode" title="Toggle light/dark mode">
            <span id="sunIcon">‚òÄÔ∏è</span>
            <span id="moonIcon" style="display: none;">üåô</span>
        </button>
    </div>

    <div class="section">
        <h2>üéØ Bow Setup</h2>
        <div class="input-group">
            <label for="draw-weight">Draw Weight (lbs):</label>
            <input type="number" id="draw-weight" value="60" min="0" step="1">
        </div>
        <div class="input-group">
            <label for="draw-length">Draw Length (in):</label>
            <input type="number" id="draw-length" value="28" min="0" step="0.1">
        </div>
        <div class="input-group">
            <label for="brace-height">Brace Height (in):</label>
            <input type="number" id="brace-height" value="7" min="0" step="0.1">
        </div>
    </div>

    <div class="section">
        <h2>üèπ Arrow Shaft</h2>
        <div class="input-group">
            <label for="shaft-length">Shaft Length (in):</label>
            <input type="number" id="shaft-length" value="30" min="0" step="0.1">
        </div>
        <div class="input-group">
            <label for="shaft-weight">Shaft Weight (gr/in):</label>
            <input type="number" id="shaft-weight" value="9" min="0" step="0.1">
        </div>
        <div class="input-group">
            <label for="shaft-spine">Shaft Spine:</label>
            <select id="shaft-spine">
                <option value="200">200</option>
                <option value="250">250</option>
                <option value="300" selected>300</option>
                <option value="340">340</option>
                <option value="400">400</option>
                <option value="500">500</option>
                <option value="600">600</option>
            </select>
        </div>
    </div>

    <div class="section">
        <h2>üìç Point / Insert</h2>
        <div class="input-group">
            <label for="point-weight">Point Weight (gr):</label>
            <input type="number" id="point-weight" value="100" min="0" step="1">
        </div>
        <div class="input-group">
            <label for="insert-weight">Insert Weight (gr):</label>
            <input type="number" id="insert-weight" value="20" min="0" step="1">
        </div>
    </div>

    <div class="section">
        <h2>ü™∂ Fletching</h2>
        <div class="input-group">
            <label for="fletch-weight">Fletching Weight (gr):</label>
            <input type="number" id="fletch-weight" value="20" min="0" step="1">
        </div>
        <div class="input-group">
            <label for="fletch-vanes">Vanes (2/3):</label>
            <select id="fletch-vanes">
                <option value="2">2" Vanes</option>
                <option value="3" selected>3" Vanes</option>
            </select>
        </div>
    </div>

    <div class="section">
        <h2>üèπ Nock + Other</h2>
        <div class="input-group">
            <label for="nock-weight">Nock Weight (gr):</label>
            <input type="number" id="nock-weight" value="12" min="0" step="1">
        </div>
        <div class="input-group">
            <label for="wrap-weight">Wrap + Other (gr):</label>
            <input type="number" id="wrap-weight" value="15" min="0" step="1">
        </div>
    </div>

    <div class="section">
        <h2>üìä Results</h2>
        <div class="results">
            <div class="result-item">
                <div class="label">Total Arrow Weight</div>
                <div class="value" id="total-weight">0</div>
                <div>grains</div>
            </div>
            <div class="result-item">
                <div class="label">Grains Per Pound (GPP)</div>
                <div class="value" id="gpp">0.00</div>
            </div>
            <div class="result-item">
                <div class="label">Front of Center (FOC)</div>
                <div class="value" id="foc">0%</div>
                <div class="interpretation" id="foc-interpretation"></div>
            </div>
            <div class="result-item">
                <div class="label">Estimated Speed</div>
                <div class="value" id="speed">0</div>
                <div>fps</div>
            </div>
            <div class="result-item">
                <div class="label">Kinetic Energy</div>
                <div class="value" id="ke">0</div>
                <div>ft-lbs</div>
            </div>
            <div class="result-item">
                <div class="label">Momentum</div>
                <div class="value" id="momentum">0.00</div>
                <div>slug fps</div>
                <div class="interpretation" id="momentum-interpretation">ü¶å Good for Deer | ü´é Marginal for Elk/Moose | üêª Not for Bear</div>
            </div>
        </div>

        <button onclick="saveBuild()">üíæ Save Build</button>
        <button onclick="exportCSV()">üìä Export CSV</button>
    </div>

    <script>
        // Dark Mode Toggle Logic
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');

        function setDarkMode(isDark) {
            if (isDark) {
                document.body.classList.add('dark');
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'inline';
                localStorage.setItem('darkMode', 'enabled');
            } else {
                document.body.classList.remove('dark');
                sunIcon.style.display = 'inline';
                moonIcon.style.display = 'none';
                localStorage.setItem('darkMode', 'disabled');
            }
        }

        // Load saved or system preference
        const savedTheme = localStorage.getItem('darkMode');
        if (savedTheme === 'enabled' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            setDarkMode(true);
        }

        themeToggle.addEventListener('click', () => {
            setDarkMode(!document.body.classList.contains('dark'));
        });

        // Your Original Calculation Functions (unchanged)
        function calculateArrow() {
            const drawWeight = parseFloat(document.getElementById('draw-weight').value) || 0;
            const drawLength = parseFloat(document.getElementById('draw-length').value) || 0;
            const braceHeight = parseFloat(document.getElementById('brace-height').value) || 0;
            const shaftLength = parseFloat(document.getElementById('shaft-length').value) || 0;
            const shaftWeight = parseFloat(document.getElementById('shaft-weight').value) || 0;
            const pointWeight = parseFloat(document.getElementById('point-weight').value) || 0;
            const insertWeight = parseFloat(document.getElementById('insert-weight').value) || 0;
            const fletchWeight = parseFloat(document.getElementById('fletch-weight').value) || 0;
            const nockWeight = parseFloat(document.getElementById('nock-weight').value) || 0;
            const wrapWeight = parseFloat(document.getElementById('wrap-weight').value) || 0;

            const shaftTotalWeight = shaftWeight * shaftLength;
            const totalArrowWeight = shaftTotalWeight + pointWeight + insertWeight + fletchWeight + nockWeight + wrapWeight;

            document.getElementById('total-weight').textContent = totalArrowWeight.toFixed(0);

            const gpp = totalArrowWeight / drawWeight;
            document.getElementById('gpp').textContent = gpp.toFixed(2);

            // Simple FOC estimate (adjust based on your formula)
            const estimatedFOC = ((pointWeight + insertWeight) / totalArrowWeight * 100).toFixed(1);
            document.getElementById('foc').textContent = estimatedFOC + '%';
            let focInterp = '';
            if (estimatedFOC < 7) focInterp = 'Low - Increase point weight';
            else if (estimatedFOC < 13) focInterp = 'Good for hunting';
            else if (estimatedFOC < 18) focInterp = 'Good for target';
            else focInterp = 'High - Reduce point weight';
            document.getElementById('foc-interpretation').textContent = focInterp;

            // Speed estimate (basic formula)
            let speed = 400 - (totalArrowWeight / 5) + (drawLength - 28);
            speed = Math.max(200, Math.min(350, speed));
            document.getElementById('speed').textContent = Math.round(speed);

            // Kinetic Energy
            const ke = (totalArrowWeight / 450240) * (speed * speed);
            document.getElementById('ke').textContent = ke.toFixed(1);

            // Momentum
            const momentum = (totalArrowWeight * speed) / 225218;
            document.getElementById('momentum').textContent = momentum.toFixed(2);
            let momInterp = '';
            if (momentum < 0.40) momInterp = 'ü¶å Good for Deer';
            else if (momentum < 0.50) momInterp = 'ü¶åü´é Good for Deer/Elk';
            else if (momentum < 0.60) momInterp = 'ü¶åü´éüêª Good for All Big Game';
            else momInterp = 'üêª+ Heavy Hitter';
            document.getElementById('momentum-interpretation').textContent = momInterp;
        }

        function saveBuild() {
            const build = {
                timestamp: new Date().toISOString(),
                ...Object.fromEntries(
                    Array.from(document.querySelectorAll('input, select')).map(el => [el.id, el.value])
                )
            };
            const builds = JSON.parse(localStorage.getItem('arrowBuilds') || '[]');
            builds.push(build);
            localStorage.setItem('arrowBuilds', JSON.stringify(builds));
            alert('Build saved! (' + builds.length + ' total)');
        }

        function exportCSV() {
            const builds = JSON.parse(localStorage.getItem('arrowBuilds') || '[]');
            if (builds.length === 0) return alert('No builds saved!');
            let csv = 'Timestamp,Draw Weight,Total Weight,GPP,FOC,Speed,KE,Momentum\n';
            builds.forEach(b => {
                csv += `"${b.timestamp}",${b['draw-weight']},${b.totalWeight || ''},${b.gpp || ''},${b.foc || ''},${b.speed || ''},${b.ke || ''},${b.momentum || ''}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'arrow-builds.csv';
            a.click();
        }

        // Event listeners for real-time updates
        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', calculateArrow);
        });

        // Initial calculation
        calculateArrow();
    </script>
</body>
</html>